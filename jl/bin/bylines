#!/usr/bin/env python


import sys

sys.path.append( "../pylib" )

from JL import DB,Byline,Journo


def main():
	conn = DB.Connect()

	c = conn.cursor()

	c.execute( 'SELECT id,shortname,prettyname FROM organisation' )
	orgs = {}
	while 1:
		row = c.fetchone()
		if not row:
			break
		orgs[ row['id'] ] = row['shortname']

	c.execute( 'SELECT id,byline,srcorg FROM article' )

	cnt=0
	blankcnt=0
	failcnt=0

	while 1:
		row = c.fetchone()
		if not row:
			break
		cnt=cnt+1

		article_id = row[0]
		byline = row[1].decode( 'utf-8' ).strip()
		if not byline:
			blankcnt = blankcnt + 1
			continue		# blank byline

		details = Byline.CrackByline( byline )

		if details is None:
			failcnt = failcnt + 1
			print "FAIL: %s" % (byline)
			continue

#		for d in details:
#			print d['name']

#		print "%s: %s" % (byline,details)

	print "Summary:"
	print "%d total" % (cnt)
	print "%d blank (%.2f%%)" % (blankcnt, float(100*blankcnt)/float(cnt) )
	print "%d failed (%.2f%%)" % (failcnt, float(100*failcnt)/float(cnt) )
	
main()

